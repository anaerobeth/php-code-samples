$(function(){function n(a){a=a.find("a.gp_label");return 0==a.length?"":a.data("arg")}function j(a){d&&d.removeClass("current");d=a;if(d.length){p=d.attr("id");d.addClass("current");var c,b;b=d.find("span").html();b=b.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");b=jQuery.parseJSON(b);c=d.find(".external").length?s:t;b=$.extend({},{title:"",layout_color:"",layout_label:"",types:"",size:"",mtime:"",opts:""},b);var h;$.each("title key url layout_label types size mtime opts".split(" "),
function(){h=RegExp("(%5B"+this+"%5D|\\["+this+"\\])","gi");c=c.replace(h,b[this])});g.show().html(c).find(".layout_icon").css({background:b.layout_color});b.special&&g.find(".not_special").hide();b.has_layout?g.find(".no_layout").hide():g.find(".has_layout").hide();b.level>=max_level_index&&g.find(".insert_child").hide();a=g.height();var e=k.height();e<a&&k.css("min-height",a);var l=d.position();if(l){var f=0;0<l.top&&(f=Math.round(100*(l.top/e)));a=l.top-f/120*a;a=Math.max(0,a);g.stop().animate({top:a})}}else g.hide()}
function q(){var a,c,b=$("#admin_menu"),h={path:gpBLink+"/Admin_Menu",expires:100};if(0<b.length){a:{a="gp_menu_hide=";for(var e=document.cookie.split(";"),d=0;d<e.length;d++){for(var f=e[d];" "==f.charAt(0);)f=f.substring(1,f.length);if(0==f.indexOf(a)){a=f.substring(a.length,f.length);break a}}a=!1}a=decodeURIComponent(a||"");e=$("#gp_curr_menu").val();a=a.replace(RegExp("#"+e+"=\\[[^#=\\]\\[]*\\]",""),"");c="#"+$("#gp_curr_menu").val()+"=[";b.find(".hidechildren > div > .gp_label").each(function(a,
b){c+=$(b).data("arg")+","});c+="]";$.cookie("gp_menu_hide",a+c,h)}$.cookie("gp_menu_prefs",$("#gp_menu_select_form").serialize(),h)}function r(){var a,c,b="";$(".menu_marker").each(function(){var d=$(this);c=d.data("menuid");a=d.children();b+="&menus["+c+"]="+encodeURIComponent(a.eq(0).val());b+="&menuh["+c+"]="+encodeURIComponent(a.eq(1).val());b+="&menuc["+c+"]="+encodeURIComponent(a.eq(2).val())});return b}var k=$("#admin_menu"),g=$("#admin_menu_tools"),d=!1,p=!1,m=!1,t=$("#menu_info").html(),
s=$("#menu_info_extern").html();k.nestedSortable({disableNesting:"no-nest",forcePlaceholderSize:!0,handle:"a.sort",items:"li",opacity:0.8,placeholder:"placeholder",tabSize:25,toleranceElement:"> div",listType:"ul",delay:2,stop:function(a,c){var b=c.item,d=b.parent().siblings("div"),e=b.children("div"),b={cmd:"drag",drag_key:n(e),parent:n(d),prev:n(b.prev().children("div")),hidden:b.closest("#menu_available_list").length};0<d.length&&d.parent(":not(.haschildren)").addClass("haschildren");0<m.length&&
0==m.find("li").length&&m.removeClass("haschildren");j(e);$gp.loading();b=jQuery.param(b,!0);b+=r();$gp.postC(window.location.href,b)},start:function(a,c){m=c.item.parent().siblings("div").parent()}}).disableSelection();gpresponse.gp_menu_refresh=function(){k.nestedSortable("refresh");if(p){var a=$("#"+p);j(a)}};$gp.links.menu_info=function(a){a.preventDefault();var c=$(this).parent();window.setTimeout(function(){j(c)},100)};$gp.links.expand_img=function(a){$gp.links.menu_info.call(this,a);$li=$(this).closest("li");
$li.hasClass("haschildren")&&($li.toggleClass("hidechildren"),q())};gpinputs.menupost=function(){var a=r(),c=$(this).closest("form");c.attr("action",$gp.jPrep(c.attr("action"),a));$gp.post(this);return!1};$gp.links.menupost=function(a){a.preventDefault();a=strip_to(this.search,"?");a+=r();$gp.postC(this.href,a)};$("#gp_menu_select").change(function(){q();var a=window.location.href;a.indexOf("?")?window.location=strip_from(a,"?"):$gp.Reload()});$(document).on("click","input:checkbox",function(){$this=
$(this);0<$this.filter(":checked").length?$this.closest("li").addClass("gpui-state-checked"):$this.closest("li").removeClass("gpui-state-checked")});$(document).on("keyup","input.gpsearch",function(){var a=this.value.toLowerCase();$(this).closest("form").find(".gpui-scrolllist li:not(.gpui-state-checked)").each(function(){var c=$(this);-1==c.text().toLowerCase().indexOf(a)?c.hide():c.show()})});var u=$("#admin_menu").find("div:first");j(u);q()});